<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>javascript on Trim21&#39;s Blog</title>
    <link>https://blog.trim21.me/tags/javascript/</link>
    <description>Recent content in javascript on Trim21&#39;s Blog</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <lastBuildDate>Mon, 03 Mar 2025 05:55:21 +0800</lastBuildDate>
    <atom:link href="https://blog.trim21.me/tags/javascript/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>在UserScript中使用Vue</title>
      <link>https://blog.trim21.me/2018/10/use-vue-in-userscript/</link>
      <pubDate>Thu, 11 Oct 2018 15:26:00 +0800</pubDate>
      <guid>https://blog.trim21.me/2018/10/use-vue-in-userscript/</guid>
      <description>&lt;p&gt;之前写了一个用户脚本, &lt;a href=&#34;https://github.com/Trim21/bgm-tv-auto-tracker&#34;&gt;在站外一键点 bgm 格子&lt;/a&gt; 为了添加一个 UI, 但又不想用 jQuery 手动绑一堆事件, 就直接上了 Vue. 所以需要用 Webpack 打包对应的 vue 文件到 userscript 里.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://blog.trim21.me/static/bd69bf14ly1fw4c4bspy5j20b10cagmq.jpg&#34; alt=&#34;效果图&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;按钮和弹出框都是 Vue 做的.&lt;/p&gt;&#xA;&lt;p&gt;因为之前一直用的是&lt;code&gt;vue-cli&lt;/code&gt;提供的 webpack 模板, 所以不太熟悉 webpack, 踩了不少坑.&lt;/p&gt;&#xA;&lt;p&gt;参考&lt;a href=&#34;https://vue-loader.vuejs.org/guide/&#34;&gt;vue-loader&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;首先在 webpack 的设置中添加一个&lt;code&gt;loader&lt;/code&gt;, 再添加一个插件&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// webpack.config.js&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;VueLoaderPlugin&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;require&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;vue-loader/lib/plugin&amp;#34;&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;module&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;exports&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;module&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rules&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// ... other rules&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;/\.vue$/&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;loader&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;vue-loader&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;options&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;loaders&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;scss&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;vue-style-loader!css-loader!postcss-loader!sass-loader&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// &amp;lt;style lang=&amp;#34;scss&amp;#34;&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  },&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;plugins&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; [&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// make sure to include the plugin!&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;VueLoaderPlugin&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后在代码里, 参照 Vue 官方的模板, 只要初始化一个实例就能正常显示内容了.&lt;/p&gt;</description>
    </item>
    <item>
      <title>使用webpack打包userscript</title>
      <link>https://blog.trim21.me/2018/10/webpack-userscript/</link>
      <pubDate>Wed, 03 Oct 2018 11:15:35 +0800</pubDate>
      <guid>https://blog.trim21.me/2018/10/webpack-userscript/</guid>
      <description>&lt;p&gt;原本用的是 grunt 来打包 webpack, 但是 grunt 只是依赖于简单的字符串替换和拼接, 效率过低.&lt;/p&gt;&#xA;&lt;p&gt;既然 webpack 可以用来打包别的 js 文件, 那么打包一个 userscript 肯定也没什么问题, 甚至大材小用了.&lt;/p&gt;&#xA;&lt;p&gt;所以自己写了一个模板&lt;a href=&#34;https://github.com/Trim21/webpack-userscript-template&#34;&gt;webpack-userscript-template&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;因为找了一下, 发现相应的工具还是有些缺陷的.&lt;/p&gt;&#xA;&lt;p&gt;主要有两个问题:&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;生成 userscript 的 meta 注释&lt;/li&gt;&#xA;&lt;li&gt;没有一个好用的 http client 库.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;所以为了自己写 userscript 爽一点, 写了两个库解决了这个问题.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/Trim21/userscript-metadata-webpack-plugin&#34;&gt;userscript-metadata-webpack-plugin&lt;/a&gt;用来解决生成 meta 的问题&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/Trim21/axios-userscript-adapter&#34;&gt;axios-userscript-adapter&lt;/a&gt;是 axios 的一个 adapter, 用来解决进行 http 请求的问题.&lt;/p&gt;&#xA;&lt;p&gt;本来 github 上是有一个 webpack-userscript 项目的, 但是里面不知道为什么, 打包用到的是 bash, 理解不了&amp;hellip;就自己写了一个&lt;a href=&#34;https://github.com/Trim21/webpack-userscript-template&#34;&gt;webpack-userscript-template&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;使用 axios 的时候不要忘了加入 connect 的 meta&lt;/p&gt;</description>
    </item>
    <item>
      <title>提高userscript开发效率的一些工具</title>
      <link>https://blog.trim21.me/2018/06/userscript%E5%BC%80%E5%8F%91/</link>
      <pubDate>Thu, 28 Jun 2018 04:29:21 +0800</pubDate>
      <guid>https://blog.trim21.me/2018/06/userscript%E5%BC%80%E5%8F%91/</guid>
      <description>&lt;p&gt;这已经是旧文了, 见{% post_link webpack-userscript 使用webpack打包userscript %}&lt;/p&gt;&#xA;&lt;p&gt;最一开始写 userscript 的时候是在编辑器里修改后复制粘贴到&lt;code&gt;Tampermonkey&lt;/code&gt;中,后来觉得实在是太麻烦了,就搜了一下 Github 有没有什么现成的模板可以用.&lt;/p&gt;&#xA;&lt;p&gt;发现了这个&lt;a href=&#34;https://github.com/turboteddy/userscript-grunt-template&#34;&gt;turboteddy/userscript-grunt-template&lt;/a&gt;. 用了一下发现比原来效率高了不止一点. 就根据一些个人习惯稍微改了一下&lt;/p&gt;&#xA;&lt;p&gt;因为我用的用户脚本扩展是&lt;code&gt;Tampermonkey&lt;/code&gt;,所以下文中的&lt;code&gt;Tampermonkey&lt;/code&gt;也包括了其他的同类插件.&lt;/p&gt;&#xA;&lt;p&gt;我自己实际使用的代码在这里&lt;a href=&#34;https://github.com/Trim21/userscript-grunt-template&#34;&gt;Trim21/userscript-grunt-template&lt;/a&gt;, 下面的内容以这个 repo 为准&lt;/p&gt;&#xA;&lt;h2 id=&#34;最起码需要的几个功能&#34;&gt;最起码需要的几个功能&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;代码分块,不同类型的代码放在不同的文件中,比如要插入网页的 html 要放在&lt;code&gt;html&lt;/code&gt;文件中,样式对应的代码放在&lt;code&gt;css&lt;/code&gt;文件中,这样同时拥有了编辑器或者 IDE 的自动补全.&lt;/li&gt;&#xA;&lt;li&gt;LiveReload,即修改代码后自动刷新网页查看效果.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;分成几部分来说&lt;/p&gt;&#xA;&lt;p&gt;首先是代码分块, 这点用一个打包工具就可以做到了,比如我这里用到的是&lt;code&gt;Grunt&lt;/code&gt;,因为&lt;code&gt;Grunt&lt;/code&gt;有人已经写好了一个&lt;a href=&#34;https://github.com/Zod-/grunt-userscript-meta&#34;&gt;grunt-userscript-meta&lt;/a&gt;,用来直接生成 userscript 开头的 meta 信息, 那么自动补全的问题也随之解决了.&lt;/p&gt;&#xA;&lt;h3 id=&#34;开始&#34;&gt;开始&lt;/h3&gt;&#xA;&lt;p&gt;Grunt 的介绍我就不贴了 不了解的话也不会太影响使用 有兴趣的话可以看&lt;a href=&#34;https://javascript.ruanyifeng.com/tool/grunt.html&#34;&gt;阮一峰的 Grunt 介绍&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone git@github.com:Trim21/userscript-grunt-template.git&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd userscript-grunt-template&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;npm i&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;npm run dev&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;更改&lt;code&gt;src/js/index.js&lt;/code&gt;中的内容,grunt 就会重新打包生成&lt;code&gt;dist/latest&lt;/code&gt;中 js 的内容&lt;/p&gt;&#xA;&lt;p&gt;所有的原文件都在&lt;code&gt;src&lt;/code&gt;文件夹中,&lt;code&gt;html&lt;/code&gt;和&lt;code&gt;css&lt;/code&gt;要在对应的文件夹里.&lt;/p&gt;&#xA;&lt;p&gt;如果在 js 中想要引用对应的内容,要用到&lt;code&gt;/* @include ../html/page1.html */&lt;/code&gt;这样的语法.(基于&lt;a href=&#34;https://github.com/jsoverson/grunt-preprocess&#34;&gt;&lt;code&gt;grunt-preprocess&lt;/code&gt;&lt;/a&gt;)&lt;/p&gt;&#xA;&lt;p&gt;比如说要使用&lt;code&gt;GM_addStyle&lt;/code&gt;,但是字符串又太长, 就可以把对应的样式放在&lt;code&gt;css/page1.css&lt;/code&gt;,然后在 js 中这样写&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;GM_addStyle&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/* @include ../css/page1.css */&amp;#34;&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;css/page1.css&lt;/code&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
