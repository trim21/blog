<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
            --font-size: 1.1rem;
        }
    </style>

    
    
    
    
    
    

    
    <title>基于asyncio的web框架aiohttp</title>
    <meta name="description" content="本来想扯一通标准库里添加了asyncio的意义, 什么统一了异步框架, 什么方便代码前移之类的了. 然后发现原来大家也都是用装饰器&#43;生成器来写的, 好像也没啥区别&hellip;
迁移的主要阻力也不是各个框架实现异步的方式不同, 而是用到了框架的某些特性, 在其他框架里可能没有, asyncio成为标准库也改变不了这一 …">
    <meta name="keywords" content='python'>

    <meta property="og:url" content="https://blog.trim21.me/2018/10/python-aiohttp/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="基于asyncio的web框架aiohttp">
    <meta property="og:description" content="本来想扯一通标准库里添加了asyncio的意义, 什么统一了异步框架, 什么方便代码前移之类的了. 然后发现原来大家也都是用装饰器&#43;生成器来写的, 好像也没啥区别&hellip;
迁移的主要阻力也不是各个框架实现异步的方式不同, 而是用到了框架的某些特性, 在其他框架里可能没有, asyncio成为标准库也改变不了这一 …">
    <meta property="og:image" content="https://blog.trim21.me/">
    <meta property="og:image:secure_url" content="https://blog.trim21.me/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="基于asyncio的web框架aiohttp">
    <meta name="twitter:description" content="本来想扯一通标准库里添加了asyncio的意义, 什么统一了异步框架, 什么方便代码前移之类的了. 然后发现原来大家也都是用装饰器&#43;生成器来写的, 好像也没啥区别&hellip;
迁移的主要阻力也不是各个框架实现异步的方式不同, 而是用到了框架的某些特性, 在其他框架里可能没有, asyncio成为标准库也改变不了这一 …">
    <meta property="twitter:domain" content="https://blog.trim21.me/2018/10/python-aiohttp/">
    <meta property="twitter:url" content="https://blog.trim21.me/2018/10/python-aiohttp/">
    <meta name="twitter:image" content="https://blog.trim21.me/">

    
    <link rel="canonical" href="https://blog.trim21.me/2018/10/python-aiohttp/">

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.70293498aa96b2dbb767ec11a622eb2266d8fc37a0fff88233a82952e3c72b15.js" integrity="sha256-cCk0mKqWstu3Z&#43;wRpiLrImbY/Deg//iCM6gpUuPHKxU="></script>

    
    
</head>
<body>
        <script>
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        

        <div class="nav-title">
            <a class="nav-brand" href="https://blog.trim21.me/">Trim21&#39;s Blog</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://blog.trim21.me/posts/" aria-label="" > Blog </a>
            </div>
            
            <div class="nav-link">
                <a href="https://blog.trim21.me/tags/" aria-label="" > Tags </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                <a aria-hidden="true" role="switch">
                    <span class="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
                <a aria-checked="false" aria-labelledby="hamburger-menu-toggle" id="hamburger-menu-toggle-target" role="switch">
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://blog.trim21.me/posts/" > Blog </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://blog.trim21.me/tags/" > Tags </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                    <a role="switch">
                        <span class="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>基于asyncio的web框架aiohttp</h1>

        

        
	
	
	
	
        

	

	

	
          <small role="doc-subtitle"></small>
	

	
          <p class="post-date">
              

              2018-10-05

              
                  | Updated 2025-03-11
              
          </p>
	

        <ul class="post-tags">
          
           
             <li class="post-tag"><a href="https://blog.trim21.me/tags/python">python</a></li>
           
         
        </ul>
    </div>

    <div class="post-content">
        <p>本来想扯一通标准库里添加了<code>asyncio</code>的意义, 什么统一了异步框架, 什么方便代码前移之类的了.
然后发现原来大家也都是用装饰器+生成器来写的, 好像也没啥区别&hellip;</p>
<p>迁移的主要阻力也不是各个框架实现异步的方式不同, 而是用到了框架的某些特性, 在其他框架里可能没有, <code>asyncio</code>成为标准库也改变不了这一点.</p>
<p>不过 python3.4 3.5 3.6 添加了很多新功能,语言层面的异步支持越来越好了</p>
<p>在 3.4 就是上面说的, 引入了<code>asyncio</code>的标准库.</p>
<p>3.5 有了一系列的 bug fix ,可以见<a href="https://aiohttp.readthedocs.io/en/stable/faq.html#why-is-python-3-5-3-the-lowest-supported-version">why-is-python-3-5-3-the-lowest-supported-version</a>, 还支持了<code>async/await</code>语法.</p>
<p>不过 3.5 的时候<code>async/await</code>还不是关键字, 还可以给<code>async</code>赋值, 所以到了 python3.7 的时候挂了一堆库, 因为他们用了<code>async</code>当变量&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> asyncio
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(sys<span style="color:#f92672">.</span>version_info) <span style="color:#75715e"># 3.5.4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hello</span>():
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Hello world!&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 异步调用asyncio.sleep(1):</span>
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Hello again!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#66d9ef">async</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取EventLoop:</span>
</span></span><span style="display:flex;"><span>loop <span style="color:#f92672">=</span> asyncio<span style="color:#f92672">.</span>get_event_loop()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 执行coroutine</span>
</span></span><span style="display:flex;"><span>loop<span style="color:#f92672">.</span>run_until_complete(hello())
</span></span><span style="display:flex;"><span>loop<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p>会输出</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Hello world!
</span></span><span style="display:flex;"><span>Hello again!
</span></span></code></pre></div><p>但是如果到了 python3.7, 会报错<code>SyntaxError</code>, 也因为这个原因挂了一堆库.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;app.py&#34;</span>, line <span style="color:#ae81ff">14</span>
</span></span><span style="display:flex;"><span>    async <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>          ^
</span></span><span style="display:flex;"><span>SyntaxError: invalid syntax
</span></span></code></pre></div><p>比如说 twisted, python3.7.0 是 6 月 27 号发布的, 但是直到到前两天(2018-10-05), pypi 上的最新版本还不能正常运行&hellip;</p>
<p>说了半天没用的&hellip;</p>
<p>最近在折腾的 python 框架 aiohttp 其实没有这个问题. 因为 aiohttp3.x.x 的最低版本要求就是 3.5.4, 从一开始就用到了<code>async/await</code>, 自然也不会有某个开发者把 async 再当作函数参数或者变量来赋值.</p>
<p>出于好奇, 还是了解了一下 aiohttp 这个框架, 写了几个小玩具.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> aiohttp <span style="color:#f92672">import</span> web
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> asyncio
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>route <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>RouteTableDef()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">index</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>Response(text<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;hello world&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@route.get</span>(<span style="color:#e6db74">&#39;/about&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">about</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>Response(text<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span>app<span style="color:#f92672">.</span>version <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; author Trim21&lt;trim21me@gmail.com&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@web.middleware</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">middleware</span>(request, handler):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># before handle request</span>
</span></span><span style="display:flex;"><span>    resp <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> handler(request)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> resp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_app</span>():
</span></span><span style="display:flex;"><span>    app <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>Application(middlewares<span style="color:#f92672">=</span>[middleware, ])
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0.0.1&#39;</span>
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>add_routes([
</span></span><span style="display:flex;"><span>        web<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;/&#39;</span>, index, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;index&#39;</span>),
</span></span><span style="display:flex;"><span>    ])
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>add_routes(route)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>web<span style="color:#f92672">.</span>run_app(create_app())
</span></span></code></pre></div><p>一个简单的例子, (如果需要数据库的话, 官方的例子是把 mongo 的连接池绑在了<code>app.mongo</code>上.)</p>
<p>前面提到了, 语言层面的异步支持是越来越好了, 但是类库的支持还是有些匮乏.</p>
<p>mongodb 和 redis 的支持还算可以, mongodb 的官方自己写了<a href="https://github.com/mongodb/motor"><code>motor</code></a>, aiohttp 的开发者写了<a href="https://github.com/aio-libs/aioredis"><code>aioredis</code></a>.</p>
<p>但是如果想找一个异步的关系型数据库的 ORM 就非常难了. <a href="http://techspot.zzzeek.org/2015/02/15/asynchronous-python-and-databases/">SQLAlchemy 的作者曾经写过一篇文章</a>, 说因为 python 本身就很慢, 所以异步也没有意义, 反而比同步还要慢.</p>
<p><del>但我还是相信 python, 会有那么一天变快的(</del></p>
<p>异步的 SQL ORM 主要有这么几个</p>
<ol>
<li><a href="https://github.com/05bit/peewee-async"><code>peewee-async</code></a></li>
<li><a href="https://github.com/fantix/gino"><code>gino</code></a></li>
</ol>
<p><code>gino</code>直接 pass, 因为目前只支持 postgreSQL.</p>
<p><code>peewee-async</code>的问题是, 他其实是基于 peewee 的, 你要通过 peewee 来定义你的模块, 然后用<code>peewee-async</code>给的一个<code>Manager</code>来异步调用.</p>
<p>举个例子, 他的异步代码是长这样的</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> peewee
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> peewee_async <span style="color:#f92672">import</span> Manager, PostgresqlDatabase
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>(peewee<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    username <span style="color:#f92672">=</span> peewee<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">40</span>, unique<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Twitter</span>(peewee<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    user <span style="color:#f92672">=</span> peewee<span style="color:#f92672">.</span>ForeignKeyField(model<span style="color:#f92672">=</span>User, backref<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tweets&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>objects <span style="color:#f92672">=</span> Manager(PostgresqlDatabase(<span style="color:#e6db74">&#39;test&#39;</span>))
</span></span><span style="display:flex;"><span>objects<span style="color:#f92672">.</span>database<span style="color:#f92672">.</span>allow_sync <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>  <span style="color:#75715e"># this will raise AssertionError on ANY sync call</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_async_func</span>():
</span></span><span style="display:flex;"><span>    user0 <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> objects<span style="color:#f92672">.</span>create(User, username<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;test&#39;</span>)
</span></span><span style="display:flex;"><span>    user1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> objects<span style="color:#f92672">.</span>get(User, id<span style="color:#f92672">=</span>user0<span style="color:#f92672">.</span>id)
</span></span><span style="display:flex;"><span>    user2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> objects<span style="color:#f92672">.</span>get(User, username<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;test&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># All should be the same</span>
</span></span><span style="display:flex;"><span>    print(user0<span style="color:#f92672">.</span>id, user1<span style="color:#f92672">.</span>id, user2<span style="color:#f92672">.</span>id)
</span></span><span style="display:flex;"><span>    print(user0<span style="color:#f92672">.</span>tweets)  <span style="color:#75715e"># raise exception here</span>
</span></span></code></pre></div><p>像这个例子比较简单, 就只有一个外键, 还添加了<code>backref</code>, 就容易出问题了.</p>
<p>因为本身是异步框架, 所以同步的代码都会阻塞整个事件循环, 在使用 orm 的时候会先设置禁止同步链接数据库, 只允许异步链接. 但是如果用了外键, peewee 在你试图获取对应的属性的时候就会链接数据库, 取回对应的数据. 所以如果用了外键, 在查询和使用实例的时候总要小心翼翼的, 以避免触发同步查询.</p>
<p>也许不用外键, 直接存 id 进去, 不依赖数据库的约束, 而在 web 层面约束可能好一些, 不会出现类似的问题.</p>
<p>ORM 扯完了, 几个经常会用到的东西.</p>
<p>模板: <a href="https://github.com/aio-libs/aiohttp-jinja2"><code>aiohttp-jinja2</code></a></p>
<p>session: <a href="https://github.com/aio-libs/aiohttp-session"><code>aiohttp-session</code></a></p>
<p>辅助的开发服务器, 支持 livereload 和 hotreload<a href="https://github.com/aio-libs/aiohttp-devtools"><code>aiohttp-devtools</code></a></p>
<p>devtools 有一些坑, 主要是项目的 readme 不是很全, 主要还是要靠 cli 的 help 信息和源码&hellip;</p>
<p>比如, 我的项目结构是这样的</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>project
</span></span><span style="display:flex;"><span>├─ Dockerfile
</span></span><span style="display:flex;"><span>├─ README.md
</span></span><span style="display:flex;"><span>├─ requirements.txt
</span></span><span style="display:flex;"><span>└──app
</span></span><span style="display:flex;"><span>   ├─ main.py
</span></span><span style="display:flex;"><span>   ├─static
</span></span><span style="display:flex;"><span>   │  └─css
</span></span><span style="display:flex;"><span>   │    └── 1.css
</span></span><span style="display:flex;"><span>   └──templates
</span></span><span style="display:flex;"><span>      └── index.html
</span></span></code></pre></div><p>这里有一个潜在的坑, 如果你要在<code>project</code>目录下直接启动服务器的话, 是不能提供<code>app-path</code>的, 而是用通过<code>--root</code>来启动, 比如说<code>adev runserver --root app</code></p>
<p>但是如果你的<code>pwd</code>是<code>app</code>, 此时不需要提供<code>root-path</code>, 只需要提供<code>app-apth</code>, 启动命令变为<code>adev runserver main.py</code></p>
<p>贴一下<code>runserver</code>的 help 信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>Usage: adev runserver [OPTIONS] [APP_PATH]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Run a development server for an aiohttp apps.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Takes one argument &#34;app-path&#34; which should be a path to either a directory
</span></span><span style="display:flex;"><span>  containing a recognized default file (&#34;app.py&#34; or &#34;main.py&#34;) or to a
</span></span><span style="display:flex;"><span>  specific file. Defaults to the environment variable &#34;AIO_APP_PATH&#34; or &#34;.&#34;.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  The app path is run directly, see the &#34;--app-factory&#34; option for details
</span></span><span style="display:flex;"><span>  on how an app is loaded from a python module.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>  -s, --static DIRECTORY          Path of static files to serve, if excluded
</span></span><span style="display:flex;"><span>                                  static files aren&#39;t served. env variable:
</span></span><span style="display:flex;"><span>                                  AIO_STATIC_STATIC
</span></span><span style="display:flex;"><span>  --root DIRECTORY                Root directory project used to qualify other
</span></span><span style="display:flex;"><span>                                  paths. env variable: AIO_ROOT
</span></span><span style="display:flex;"><span>  --static-url TEXT               URL path to serve static files from, default
</span></span><span style="display:flex;"><span>                                  &#34;/static/&#34;. env variable: AIO_STATIC_URL
</span></span><span style="display:flex;"><span>  --livereload / --no-livereload  Whether to inject livereload.js into html
</span></span><span style="display:flex;"><span>                                  page footers to autoreload on changes. env
</span></span><span style="display:flex;"><span>                                  variable AIO_LIVERELOAD
</span></span><span style="display:flex;"><span>  --host TEXT                     host used when referencing livereload and
</span></span><span style="display:flex;"><span>                                  static files, if blank host is taken from
</span></span><span style="display:flex;"><span>                                  the request header with default of
</span></span><span style="display:flex;"><span>                                  localhost. env variable AIO_HOST
</span></span><span style="display:flex;"><span>  --debug-toolbar / --no-debug-toolbar
</span></span><span style="display:flex;"><span>                                  Whether to enable debug toolbar. env
</span></span><span style="display:flex;"><span>                                  variable: AIO_DEBUG_TOOLBAR
</span></span><span style="display:flex;"><span>  --app-factory TEXT              name of the app factory to create an
</span></span><span style="display:flex;"><span>                                  aiohttp.web.Application with, if missing
</span></span><span style="display:flex;"><span>                                  default app-factory names are tried. This
</span></span><span style="display:flex;"><span>                                  can be either a function with signature &#34;def
</span></span><span style="display:flex;"><span>                                  create_app(loop): -&gt; Application&#34; or &#34;def
</span></span><span style="display:flex;"><span>                                  create_app(): -&gt; Application&#34; or just an
</span></span><span style="display:flex;"><span>                                  instance of aiohttp.Application. env
</span></span><span style="display:flex;"><span>                                  variable AIO_APP_FACTORY
</span></span><span style="display:flex;"><span>  -p, --port INTEGER              Port to serve app from, default 8000. env
</span></span><span style="display:flex;"><span>                                  variable: AIO_PORT
</span></span><span style="display:flex;"><span>  --aux-port INTEGER              Port to serve auxiliary app (reload and
</span></span><span style="display:flex;"><span>                                  static) on, default port + 1. env variable:
</span></span><span style="display:flex;"><span>                                  AIO_AUX_PORT
</span></span><span style="display:flex;"><span>  -v, --verbose                   Enable verbose output.
</span></span><span style="display:flex;"><span>  --help                          Show this message and exit.
</span></span></code></pre></div><p>其中, <code>-s, --static</code>因为实际上静态文件要通过<code>--aux-port</code>去访问, 所以感觉有些鸡肋.</p>
<p>也就是说, 如果正常的服务器启动在<code>6001</code>端口, 而<code>aux-server</code>启动在<code>6002</code>端口, 我们要使用这个参数代理的静态文件的话, 要访问<code>http://localhost:6002/static/1.css</code>, 而正常我们会把静态文件放在同一个域名下, 也就是<code>http://localhost:6001/static/1.css</code>, 所以我的选择是直接添加一个<code>web.static</code>的路由, 而不是使用的这个功能.</p>

        
    </div>

    <div class="prev-next">
        
    </div>

    
    
    
    <div id="comments">
        <script src="https://utteranc.es/client.js"
    repo="trim21/blog"
    issue-term="pathname"
    crossorigin="anonymous"
    async></script>

    </div>
    
</div>



    

        </main><footer class="footer">
    
    

    

    

    

    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/gokarna-theme/gokarna-hugo">Gokarna</a>
    </span>
</footer>
</body>
</html>
