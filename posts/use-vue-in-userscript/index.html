<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
            --font-size: 17.5px;
        }
    </style>

    
    
    
    
    
    

    
    <title>在UserScript中使用Vue</title>
    <meta name="description" content="之前写了一个用户脚本, 在站外一键点 bgm 格子 为了添加一个 UI, 但又不想用 jQuery 手动绑一堆事件, 就直接上了 Vue. 所以需要用 Webpack 打包对应的 vue 文件到 userscript 里.
按钮和弹出框都是 Vue 做的.
因为之前一直用的是vue-cli提供的 webpack 模板, …">
    <meta name="keywords" content='vue, userscript, javascript'>

    <meta property="og:url" content="https://blog.trim21.me/posts/use-vue-in-userscript/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="在UserScript中使用Vue">
    <meta property="og:description" content="之前写了一个用户脚本, 在站外一键点 bgm 格子 为了添加一个 UI, 但又不想用 jQuery 手动绑一堆事件, 就直接上了 Vue. 所以需要用 Webpack 打包对应的 vue 文件到 userscript 里.
按钮和弹出框都是 Vue 做的.
因为之前一直用的是vue-cli提供的 webpack 模板, …">
    <meta property="og:image" content="https://blog.trim21.me/">
    <meta property="og:image:secure_url" content="https://blog.trim21.me/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="在UserScript中使用Vue">
    <meta name="twitter:description" content="之前写了一个用户脚本, 在站外一键点 bgm 格子 为了添加一个 UI, 但又不想用 jQuery 手动绑一堆事件, 就直接上了 Vue. 所以需要用 Webpack 打包对应的 vue 文件到 userscript 里.
按钮和弹出框都是 Vue 做的.
因为之前一直用的是vue-cli提供的 webpack 模板, …">
    <meta property="twitter:domain" content="https://blog.trim21.me/posts/use-vue-in-userscript/">
    <meta property="twitter:url" content="https://blog.trim21.me/posts/use-vue-in-userscript/">
    <meta name="twitter:image" content="https://blog.trim21.me/">

    
    <link rel="canonical" href="https://blog.trim21.me/posts/use-vue-in-userscript/">

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.275fedb6f364c8865658bae576d82b514ace973f6a13ed63503a85b20c697453.js" integrity="sha256-J1/ttvNkyIZWWLrldtgrUUrOlz9qE&#43;1jUDqFsgxpdFM="></script>

    
    
</head>
<body>
        <script>
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        

        <div class="nav-title">
            <a class="nav-brand" href="https://blog.trim21.me/">Trim21&#39;s Blog</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://blog.trim21.me/posts/" aria-label="" > Blog </a>
            </div>
            
            <div class="nav-link">
                <a href="https://blog.trim21.me/about/" aria-label="" > About </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                <a aria-hidden="true" role="switch">
                    <span class="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
                <a aria-checked="false" aria-labelledby="hamburger-menu-toggle" id="hamburger-menu-toggle-target" role="switch">
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://blog.trim21.me/posts/" > Blog </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://blog.trim21.me/about/" > About </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                    <a role="switch">
                        <span class="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>在UserScript中使用Vue</h1>

        

        
	
	
	
	
        

	

	

	
          <small role="doc-subtitle"></small>
	

	
          <p class="post-date">
              

              October 11, 2018

              
          </p>
	

        <ul class="post-tags">
          
           
             <li class="post-tag"><a href="https://blog.trim21.me/tags/vue">vue</a></li>
           
         
           
             <li class="post-tag"><a href="https://blog.trim21.me/tags/userscript">userscript</a></li>
           
         
           
             <li class="post-tag"><a href="https://blog.trim21.me/tags/javascript">javascript</a></li>
           
         
        </ul>
    </div>

    <div class="post-content">
        <p>之前写了一个用户脚本, <a href="https://github.com/Trim21/bgm-tv-auto-tracker">在站外一键点 bgm 格子</a> 为了添加一个 UI, 但又不想用 jQuery 手动绑一堆事件, 就直接上了 Vue. 所以需要用 Webpack 打包对应的 vue 文件到 userscript 里.</p>
<p><img src="/static/bd69bf14ly1fw4c4bspy5j20b10cagmq.jpg" alt="效果图"></p>
<p>按钮和弹出框都是 Vue 做的.</p>
<p>因为之前一直用的是<code>vue-cli</code>提供的 webpack 模板, 所以不太熟悉 webpack, 踩了不少坑.</p>
<p>参考<a href="https://vue-loader.vuejs.org/guide/">vue-loader</a></p>
<p>首先在 webpack 的设置中添加一个<code>loader</code>, 再添加一个插件</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// webpack.config.js
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> VueLoaderPlugin <span style="color:#ff7b72;font-weight:bold">=</span> require(<span style="color:#a5d6ff">&#34;vue-loader/lib/plugin&#34;</span>);
</span></span><span style="display:flex;"><span>module.exports <span style="color:#ff7b72;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>  module<span style="color:#ff7b72;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>    rules<span style="color:#ff7b72;font-weight:bold">:</span> [
</span></span><span style="display:flex;"><span>      <span style="color:#8b949e;font-style:italic">// ... other rules
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>      {
</span></span><span style="display:flex;"><span>        test<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#79c0ff">/\.vue$/</span>,
</span></span><span style="display:flex;"><span>        loader<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;vue-loader&#34;</span>,
</span></span><span style="display:flex;"><span>        options<span style="color:#ff7b72;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>          loaders<span style="color:#ff7b72;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>            scss<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;vue-style-loader!css-loader!postcss-loader!sass-loader&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#8b949e;font-style:italic">// &lt;style lang=&#34;scss&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>          },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  plugins<span style="color:#ff7b72;font-weight:bold">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic">// make sure to include the plugin!
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>    <span style="color:#ff7b72">new</span> VueLoaderPlugin(),
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>然后在代码里, 参照 Vue 官方的模板, 只要初始化一个实例就能正常显示内容了.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> App from <span style="color:#a5d6ff">&#34;. /App&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> Vue from <span style="color:#a5d6ff">&#34;vue&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> axios from <span style="color:#a5d6ff">&#34;axios&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> $ from <span style="color:#a5d6ff">&#34;jquery&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$(<span style="color:#a5d6ff">&#34;#container&#34;</span>).append(<span style="color:#a5d6ff">`&lt;div id=&#39;bgm_tv_app&#39;&gt;&lt;/div&gt;`</span>);
</span></span><span style="display:flex;"><span>Vue.prototype.$http <span style="color:#ff7b72;font-weight:bold">=</span> axios;
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// eslint-disable-next-line no-new
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">new</span> Vue({
</span></span><span style="display:flex;"><span>  el<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;#bgm_tv_app&#34;</span>,
</span></span><span style="display:flex;"><span>  render<span style="color:#ff7b72;font-weight:bold">:</span> (h) =&gt; h(App),
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>其中, <code>el</code>就是要绑定元素, 因为网页上一般没有, 所以往往还是要用 JS 手动插一个进去, 然后再初始化 Vue.</p>
<p>然后为了能编译出来的文件不会显示一些无用的更改, 最好加上<a href="https://webpack.js.org/plugins/hashed-module-ids-plugin/">HashedModuleIdsPlugin</a>等.</p>
<p>同时为了减小最后编译出来的脚本文件的体积, 最好使用 webpack 的 external 设置, 比如 Vue, jQuery 之类的.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>externals<span style="color:#ff7b72;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>  jquery<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;$&#39;</span>,
</span></span><span style="display:flex;"><span>  vue<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;Vue&#39;</span>,
</span></span><span style="display:flex;"><span>  axios<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;axios&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a5d6ff">&#39;axios-userscript-adapter&#39;</span><span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;axiosGmxhrAdapter&#39;</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这样可以避免 webpack 把 Vue, axios 之类库的原文件打包进来, 造成脚本体积非常大.(但是要记得在 meta 里加上对应的 js 文件)</p>
<p>\EOF</p>

        
        <div class="post-comments">
            <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "trim21" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
        
    </div>

    <div class="prev-next">
        
    </div>

    
    
    
</div>



    

        </main><footer class="footer">
    
    

    

    

    

    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/gokarna-theme/gokarna-hugo">Gokarna</a>
    </span>
</footer>
</body>
</html>
