<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
            --font-size: 17.5px;
        }
    </style>

    
    
    
    
    
    

    
    <title>给win10应用商店设置代理</title>
    <meta name="description" content="最近网络状况实在是不好,用 win10 应用商店下载应用怎么也不成功.修改系统代理也不管用. 参照少数派的这篇文章设置了代理,总算是解决了问题.
其中,最麻烦的是找到对应 uwp 应用的 sid,因为是要在表里一项一项的去找.
win10 商店对应的应用在注册表中的DisplayName …">
    <meta name="keywords" content='python, windows'>

    <meta property="og:url" content="https://blog.trim21.me/posts/set-proxy-for-win10-store/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="给win10应用商店设置代理">
    <meta property="og:description" content="最近网络状况实在是不好,用 win10 应用商店下载应用怎么也不成功.修改系统代理也不管用. 参照少数派的这篇文章设置了代理,总算是解决了问题.
其中,最麻烦的是找到对应 uwp 应用的 sid,因为是要在表里一项一项的去找.
win10 商店对应的应用在注册表中的DisplayName …">
    <meta property="og:image" content="https://blog.trim21.me/">
    <meta property="og:image:secure_url" content="https://blog.trim21.me/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="给win10应用商店设置代理">
    <meta name="twitter:description" content="最近网络状况实在是不好,用 win10 应用商店下载应用怎么也不成功.修改系统代理也不管用. 参照少数派的这篇文章设置了代理,总算是解决了问题.
其中,最麻烦的是找到对应 uwp 应用的 sid,因为是要在表里一项一项的去找.
win10 商店对应的应用在注册表中的DisplayName …">
    <meta property="twitter:domain" content="https://blog.trim21.me/posts/set-proxy-for-win10-store/">
    <meta property="twitter:url" content="https://blog.trim21.me/posts/set-proxy-for-win10-store/">
    <meta name="twitter:image" content="https://blog.trim21.me/">

    
    <link rel="canonical" href="https://blog.trim21.me/posts/set-proxy-for-win10-store/">

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.275fedb6f364c8865658bae576d82b514ace973f6a13ed63503a85b20c697453.js" integrity="sha256-J1/ttvNkyIZWWLrldtgrUUrOlz9qE&#43;1jUDqFsgxpdFM="></script>

    
    
</head>
<body>
        <script>
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        

        <div class="nav-title">
            <a class="nav-brand" href="https://blog.trim21.me/">Trim21&#39;s Blog</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://blog.trim21.me/posts/" aria-label="" > Blog </a>
            </div>
            
            <div class="nav-link">
                <a href="https://blog.trim21.me/about/" aria-label="" > About </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                <a aria-hidden="true" role="switch">
                    <span class="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
                <a aria-checked="false" aria-labelledby="hamburger-menu-toggle" id="hamburger-menu-toggle-target" role="switch">
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://blog.trim21.me/posts/" > Blog </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://blog.trim21.me/about/" > About </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                    <a role="switch">
                        <span class="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>给win10应用商店设置代理</h1>

        

        
	
	
	
	
        

	

	

	
          <small role="doc-subtitle"></small>
	

	
          <p class="post-date">
              

              June 26, 2019

              
          </p>
	

        <ul class="post-tags">
          
           
             <li class="post-tag"><a href="https://blog.trim21.me/tags/python">python</a></li>
           
         
           
             <li class="post-tag"><a href="https://blog.trim21.me/tags/windows">windows</a></li>
           
         
        </ul>
    </div>

    <div class="post-content">
        <p>最近网络状况实在是不好,用 win10 应用商店下载应用怎么也不成功.修改系统代理也不管用.
参照<a href="https://sspai.com/post/41137">少数派的这篇文章</a>设置了代理,总算是解决了问题.</p>
<p>其中,最麻烦的是找到对应 uwp 应用的 sid,因为是要在表里一项一项的去找.</p>
<p>win10 商店对应的应用在注册表中的<code>DisplayName</code>是<code>Microsoft.WindowsStore</code>,
所以遍历<code>HKEY_CURRENT_USER\Software\Classes\Local Settings\Software\Microsoft\Windows\CurrentVersion\AppContainer\Mappings</code>的所有子 key,找到对应<code>DisplayName</code>中包含<code>Microsoft.WindowsStore</code>的一项就可以了.</p>
<p>因为手动一项一项的去找效率实在是太低,就直接写了个 python 脚本来遍历.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">winreg</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">iterkeys</span>(key):
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 获取该键的所有子键，因为没有方法可以获取子键的个数，所以只能用这种方法进行遍历</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">try</span>:
</span></span><span style="display:flex;"><span>        i <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">while</span> <span style="color:#79c0ff">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#8b949e;font-style:italic"># EnumValue方法用来枚举键值，EnumKey用来枚举子键</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff7b72">yield</span> winreg<span style="color:#ff7b72;font-weight:bold">.</span>EnumKey(key, i)
</span></span><span style="display:flex;"><span>            i <span style="color:#ff7b72;font-weight:bold">+=</span> <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">except</span> <span style="color:#f0883e;font-weight:bold">WindowsError</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">itervalues</span>(key):
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 获取该键的所有键值，因为没有方法可以获取键值的个数，所以只能用这种方法进行遍历</span>
</span></span><span style="display:flex;"><span>    d <span style="color:#ff7b72;font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">try</span>:
</span></span><span style="display:flex;"><span>        i <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">while</span> <span style="color:#79c0ff">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#8b949e;font-style:italic"># EnumValue方法用来枚举键值，EnumKey用来枚举子键</span>
</span></span><span style="display:flex;"><span>            name, value, _ <span style="color:#ff7b72;font-weight:bold">=</span> winreg<span style="color:#ff7b72;font-weight:bold">.</span>EnumValue(key, i)
</span></span><span style="display:flex;"><span>            d[name] <span style="color:#ff7b72;font-weight:bold">=</span> value
</span></span><span style="display:flex;"><span>            i <span style="color:#ff7b72;font-weight:bold">+=</span> <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">except</span> <span style="color:#f0883e;font-weight:bold">WindowsError</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">return</span> d
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">main</span>():
</span></span><span style="display:flex;"><span>    base_key <span style="color:#ff7b72;font-weight:bold">=</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#79c0ff">r</span><span style="color:#a5d6ff">&#34;Software\Classes\Local Settings\Software&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#79c0ff">r</span><span style="color:#a5d6ff">&#34;\Microsoft\Windows\CurrentVersion\AppContainer\Mappings</span><span style="color:#79c0ff">\\</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    mappings <span style="color:#ff7b72;font-weight:bold">=</span> winreg<span style="color:#ff7b72;font-weight:bold">.</span>OpenKey(winreg<span style="color:#ff7b72;font-weight:bold">.</span>HKEY_CURRENT_USER, base_key)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">for</span> key <span style="color:#ff7b72;font-weight:bold">in</span> iterkeys(mappings):
</span></span><span style="display:flex;"><span>        k <span style="color:#ff7b72;font-weight:bold">=</span> winreg<span style="color:#ff7b72;font-weight:bold">.</span>OpenKey(winreg<span style="color:#ff7b72;font-weight:bold">.</span>HKEY_CURRENT_USER, base_key <span style="color:#ff7b72;font-weight:bold">+</span> key)
</span></span><span style="display:flex;"><span>        info <span style="color:#ff7b72;font-weight:bold">=</span> itervalues(k)
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">if</span> <span style="color:#a5d6ff">&#39;WindowsStore&#39;</span> <span style="color:#ff7b72;font-weight:bold">in</span> info[<span style="color:#a5d6ff">&#39;DisplayName&#39;</span>]:
</span></span><span style="display:flex;"><span>            print(info[<span style="color:#a5d6ff">&#39;DisplayName&#39;</span>])
</span></span><span style="display:flex;"><span>            print(key)
</span></span><span style="display:flex;"><span>            <span style="color:#ff7b72">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">if</span> __name__ <span style="color:#ff7b72;font-weight:bold">==</span> <span style="color:#a5d6ff">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><p>直接保存成 py 文件,然后运行,控制台的第二行会输出类似<code>S-1-15-2-****</code>的一个 SID,就是在<code>CheckNetIsolation.exe loopbackexempt -a -p=${SID}</code>中要用到的 SID.</p>
<p>这之后,设置系统代理,重启 win10 商店,就能通过代理下载应用了.</p>

        
        <div class="post-comments">
            <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "trim21" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
        
    </div>

    <div class="prev-next">
        
    </div>

    
    
    
</div>



    

        </main><footer class="footer">
    
    

    

    

    

    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/gokarna-theme/gokarna-hugo">Gokarna</a>
    </span>
</footer>
</body>
</html>
